<!--
    @license
    Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
    This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
    The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
    The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
    Code distributed by Google as part of the polymer project is also
    subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!DOCTYPE html><html><head><script src="packages/web_components/webcomponents.min.js"></script><script src="packages/web_components/dart_support.js"></script>

  <title>core-scroll-threshold</title>

  

  

</head>
<body unresolved=""><div hidden=""><script src="packages/web_components/interop_support.js"></script>

<!-- Dart note: load polymer for Dart and JS from the same place -->
<style shim-shadowdom="">
/*******************************
          Flex Layout
*******************************/

html /deep/ [layout][horizontal], html /deep/ [layout][vertical] {
  display: -ms-flexbox;
  display: -webkit-flex;
  display: flex;
}

html /deep/ [layout][horizontal][inline], html /deep/ [layout][vertical][inline] {
  display: -ms-inline-flexbox;
  display: -webkit-inline-flex;
  display: inline-flex;
}

html /deep/ [layout][horizontal] {
  -ms-flex-direction: row;
  -webkit-flex-direction: row;
  flex-direction: row;
}

html /deep/ [layout][horizontal][reverse] {
  -ms-flex-direction: row-reverse;
  -webkit-flex-direction: row-reverse;
  flex-direction: row-reverse;
}

html /deep/ [layout][vertical] {
  -ms-flex-direction: column;
  -webkit-flex-direction: column;
  flex-direction: column;
}

html /deep/ [layout][vertical][reverse] {
  -ms-flex-direction: column-reverse;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
}

html /deep/ [layout][wrap] {
  -ms-flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
}

html /deep/ [layout][wrap-reverse] {
  -ms-flex-wrap: wrap-reverse;
  -webkit-flex-wrap: wrap-reverse;
  flex-wrap: wrap-reverse;
}

html /deep/ [flex] {
  -ms-flex: 1 1 0.000000001px;
  -webkit-flex: 1;
  flex: 1;
  -webkit-flex-basis: 0.000000001px;
  flex-basis: 0.000000001px;
}

html /deep/ [vertical][layout] > [flex][auto-vertical], html /deep/ [vertical][layout]::shadow [flex][auto-vertical] {
  -ms-flex: 1 1 auto;
  -webkit-flex-basis: auto;
  flex-basis: auto;
}

html /deep/ [flex][auto] {
  -ms-flex: 1 1 auto;
  -webkit-flex-basis: auto;
  flex-basis: auto;
}

html /deep/ [flex][none] {
  -ms-flex: none;
  -webkit-flex: none;
  flex: none;
}

html /deep/ [flex][one] {
  -ms-flex: 1;
  -webkit-flex: 1;
  flex: 1;
}

html /deep/ [flex][two] {
  -ms-flex: 2;
  -webkit-flex: 2;
  flex: 2;
}

html /deep/ [flex][three] {
  -ms-flex: 3;
  -webkit-flex: 3;
  flex: 3;
}

html /deep/ [flex][four] {
  -ms-flex: 4;
  -webkit-flex: 4;
  flex: 4;
}

html /deep/ [flex][five] {
  -ms-flex: 5;
  -webkit-flex: 5;
  flex: 5;
}

html /deep/ [flex][six] {
  -ms-flex: 6;
  -webkit-flex: 6;
  flex: 6;
}

html /deep/ [flex][seven] {
  -ms-flex: 7;
  -webkit-flex: 7;
  flex: 7;
}

html /deep/ [flex][eight] {
  -ms-flex: 8;
  -webkit-flex: 8;
  flex: 8;
}

html /deep/ [flex][nine] {
  -ms-flex: 9;
  -webkit-flex: 9;
  flex: 9;
}

html /deep/ [flex][ten] {
  -ms-flex: 10;
  -webkit-flex: 10;
  flex: 10;
}

html /deep/ [flex][eleven] {
  -ms-flex: 11;
  -webkit-flex: 11;
  flex: 11;
}

html /deep/ [flex][twelve] {
  -ms-flex: 12;
  -webkit-flex: 12;
  flex: 12;
}

/* alignment in cross axis */

html /deep/ [layout][start] {
  -ms-flex-align: start;
  -webkit-align-items: flex-start;
  align-items: flex-start;
}

html /deep/ [layout][center], html /deep/ [layout][center-center] {
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
}

html /deep/ [layout][end] {
  -ms-flex-align: end;
  -webkit-align-items: flex-end;
  align-items: flex-end;
}

/* alignment in main axis */

html /deep/ [layout][start-justified] {
  -ms-flex-pack: start;
  -webkit-justify-content: flex-start;
  justify-content: flex-start;
}

html /deep/ [layout][center-justified], html /deep/ [layout][center-center] {
  -ms-flex-pack: center;
  -webkit-justify-content: center;
  justify-content: center;
}

html /deep/ [layout][end-justified] {
  -ms-flex-pack: end;
  -webkit-justify-content: flex-end;
  justify-content: flex-end;
}

html /deep/ [layout][around-justified] {
  -ms-flex-pack: distribute;
  -webkit-justify-content: space-around;
  justify-content: space-around;
}

html /deep/ [layout][justified] {
  -ms-flex-pack: justify;
  -webkit-justify-content: space-between;
  justify-content: space-between;
}

/* self alignment */

html /deep/ [self-start] {
  -ms-align-self: flex-start;
  -webkit-align-self: flex-start;
  align-self: flex-start;
}

html /deep/ [self-center] {
  -ms-align-self: center;
  -webkit-align-self: center;
  align-self: center;
}

html /deep/ [self-end] {
  -ms-align-self: flex-end;
  -webkit-align-self: flex-end;
  align-self: flex-end;
}

html /deep/ [self-stretch] {
  -ms-align-self: stretch;
  -webkit-align-self: stretch;
  align-self: stretch;
}

/*******************************
          Other Layout
*******************************/

html /deep/ [block] {
  display: block;
}

/* ie support for hidden */
html /deep/ [hidden] {
  display: none !important;
}

html /deep/ [relative] {
  position: relative;
}

html /deep/ [fit] {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

body[fullbleed] {
  margin: 0;
  height: 100vh;
}

/*******************************
            Other
*******************************/

html /deep/ [segment], html /deep/ segment {
  display: block;
  position: relative;
  -webkit-box-sizing: border-box;
  -ms-box-sizing: border-box;
  box-sizing: border-box;
  margin: 1em 0.5em;
  padding: 1em;
  background-color: white;
  -webkit-box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.1);
  box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.1);
  border-radius: 5px 5px 5px 5px;
}

</style>

<script src="packages/polymer/src/js/polymer/polymer.min.js"></script>

<script>
// TODO(sigmund): remove this script tag (dartbug.com/19650). This empty
// script tag is necessary to work around a bug in Chrome 36.
</script>

<!-- unminified for debugging:
<link rel="import" href="src/js/polymer/layout.html">
<script src="src/js/polymer/polymer.js"></script>
-->

<script>
// This empty script is here to workaround issue
// https://github.com/dart-lang/core-elements/issues/11
</script>


<polymer-element name="core-scroll-threshold">

<script>

  Polymer({
    
    publish: {

      /**
       * When set, the given element is observed for scroll position.  When undefined,
       * children can be placed inside and element itself can be used as the scrollable
       * element.
       *
       * @attribute scrollTarget
       * @type string
       * @default null
       */
      scrollTarget: null,

      /**
       * Orientation of the scroller to be observed (`v` for vertical, `h` for horizontal)
       *
       * @attribute orient
       * @type boolean
       * @default 'v'
       */
      orient: 'v',

      /**
       * Distance from the top (or left, for horizontal) bound of the scroller
       * where the "upper trigger" will fire.
       *
       * @attribute upperThreshold
       * @type integer
       * @default null
       */
      upperThreshold: null,

      /**
       * Distance from the bottom (or right, for horizontal) bound of the scroller
       * where the "lower trigger" will fire.
       *
       * @attribute lowerThreshold
       * @type integer
       * @default false
       */
      lowerThreshold: null,

      /**
       * Read-only value that tracks the triggered state of the upper threshold
       *
       * @attribute upperTriggered
       * @type boolean
       * @default false
       */
      upperTriggered: false,

      /**
       * Read-only value that tracks the triggered state of the lower threshold
       *
       * @attribute lowerTriggered
       * @type boolean
       * @default false
       */
      lowerTriggered: false

    },

    observe: {
      'upperThreshold lowerThreshold scrollTarget orient': 'setup'
    },

    ready: function() {
      this._boundScrollHandler = this.checkThreshold.bind(this);
    },

    setup: function() {
      // Remove listener for any previous scroll target
      if (this._scrollTarget && (this._scrollTarget != this.target)) {
        this._scrollTarget.removeEventListener(this._boundScrollHandler);
      }

      // Add listener for new scroll target
      var target = this.scrollTarget || this;
      if (target) {
        this._scrollTarget = target;
        this._scrollTarget.addEventListener('scroll', this._boundScrollHandler);
      }

      // If we're listening on ourself, make us auto in case someone put
      // content inside
      this.style.overflow = (target == this) ? 'auto' : null;

      // Setup extents based on orientation
      this.scrollPosition = (this.orient == 'v') ? 'scrollTop' : 'scrollLeft';
      this.sizeExtent = (this.orient == 'v') ? 'offsetHeight' : 'offsetWidth';
      this.scrollExtent = (this.orient == 'v') ? 'scrollHeight' : 'scrollWidth';

      // Clear trigger state if user has cleared the threshold
      if (!this.upperThreshold) {
        this.upperTriggered = false;
      }
      if (!this.lowerThreshold) {
        this.lowerTriggered = false;
      }      
    },

    checkThreshold: function(e) {
      var top = this._scrollTarget[this.scrollPosition];
      if (!this.upperTriggered && this.upperThreshold != null) {
        if (top < this.upperThreshold) {
          this.upperTriggered = true;
          this.fire('upper-trigger');
        }
      }
      if (this.lowerThreshold != null) {
        var bottom = top + this._scrollTarget[this.sizeExtent];
        var size = this._scrollTarget[this.scrollExtent];
        if (!this.lowerTriggered && (size - bottom) < this.lowerThreshold) {
          this.lowerTriggered = true;
          this.fire('lower-trigger');
        }
      }
    },

    /**
     * Clear the upper threshold, following an `upper-trigger` event.
     *
     * @method clearUpper
     * @param {boolean} waitForMutation
     */
    clearUpper: function(waitForMutation) {
      if (waitForMutation) {
        this._waitForMutation(function() {
          this.clearUpper();
        }.bind(this));
      } else {
        requestAnimationFrame(function() {
          this.upperTriggered = false;
        }.bind(this));
      }
    },

    /**
     * Clear the lower threshold, following a `lower-trigger` event.
     *
     * @method clearLower
     * @param {boolean} waitForMutation
     */
    clearLower: function(waitForMutation) {
      if (waitForMutation) {
        this._waitForMutation(function() {
          this.clearLower();
        }.bind(this));
      } else {
        requestAnimationFrame(function() {
          this.lowerTriggered = false;
        }.bind(this));
      }
    },

    _waitForMutation: function(listener) {
      var observer = new MutationObserver(function(mutations) {
        listener.call(this, observer, mutations);
        observer.disconnect();
      }.bind(this));
      observer.observe(this._scrollTarget, {attributes:true, childList: true, subtree: true});
    }

  });

</script>
</polymer-element>






<style>
    #scroller {
      height: 300px;
      border: 1px solid red;
      padding: 20px;
      overflow: auto;
    }
    .thing {
      padding: 10px;
      margin: 10px;
      background: lightblue;
      border-radius: 10px;
      font-size: 2em;
    }
  </style></div>

<template is="auto-binding-dart" id="myTemplate">
  <core-scroll-threshold id="threshold" scrolltarget="{{$['scroller']}}" lowerthreshold="100" on-lower-trigger="{{loadMore}}" fit=""></core-scroll-threshold>
  <div id="scroller" fit="">
    <template repeat="{{i in data}}">
      <div class="thing">{{i}}</div>
    </template>
    <div hidden?="{{!$['threshold'].lowerTriggered}}">Please wait...</div>
  </div>
</template>

<script src="core_scroll_threshold.html.polymer.bootstrap.dart.js" async=""></script>



</body></html>